{% extends "base/base_dashboard.html" %}
{% load static %}

{% block title %}Mis Boletas{% endblock %}

{% block page_styles %}
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" />

  <style>
    /* Forzar color de texto claro en la tabla */
    .table {
        color: #e0e8f0 !important;
    }
    
    /* Hover en filas */
    .table-hover > tbody > tr:hover > * {
        background-color: rgba(255, 255, 255, 0.05) !important;
        color: #fff !important;
    }

    /* Títulos de las columnas */
    thead th {
        color: #fff !important;
        border-bottom: 1px solid #444 !important;
    }

    /* Inputs del buscador DataTables */
    .dataTables_wrapper .dataTables_filter input {
        background-color: #2b2b35;
        color: #f1f1f1;
        border: 1px solid #444;
        border-radius: 5px;
    }
    
    /* Textos de información (Showing 1 to 10...) */
    .dataTables_wrapper .dataTables_length label,
    .dataTables_wrapper .dataTables_info {
        color: #adb5bd !important;
    }
    
    /* Selector de cantidad de registros */
    .dataTables_wrapper .dataTables_length select {
        background-color: #2b2b35;
        color: #f1f1f1;
        border: 1px solid #444;
    }
    
    /* Paginación */
    .dataTables_wrapper .dataTables_paginate .page-link {
        background-color: #2b2b35;
        border-color: #444;
        color: #f1f1f1;
    }
    .dataTables_wrapper .dataTables_paginate .page-link:hover {
        background-color: #333;
        border-color: #555;
    }
    .dataTables_wrapper .dataTables_paginate .page-item.active .page-link {
        background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        border-color: #1d4ed8;
        color: #fff;
    }
    .dataTables_wrapper .dataTables_paginate .page-item.disabled .page-link {
        background-color: #16202e;
        border-color: #2a3441;
        color: #718096;
    }
  </style>
{% endblock %}

{% block dashboard_content %}

<div class="title-wrapper pt-30 mb-20">
    <div class="row align-items-center">
        <div class="col-md-12">
            <h2 style="color: #fff;">Historial de Boletas</h2>
            <p class="text-sm" style="color: #a0aec0;">Consulta tus documentos de cobro emitidos.</p>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card-style mb-30">
            <div class="table-responsive">
                <table id="tablaBoletasCliente" class="table table-hover">
                    <thead>
                        <tr>
                            <th>Folio / ID</th>
                            <th>Periodo</th>
                            <th>Monto Total</th>
                            <th>Estado</th>
                            <th>Fecha Emisión</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for boleta in boletas_recibidas %}
                        <tr>
                            <td>#{{ boleta.folio_sii|default:boleta.id }}</td>
                            <td>
                                <span class="text-medium" style="color: #fff;">{{ boleta.mes }}/{{ boleta.ano }}</span>
                            </td>
                            <td>
                                <h6 class="text-bold" style="color: #4fd1c5;">${{ boleta.monto_total }}</h6>
                            </td>
                            <td>
                                {% if boleta.estado_pago == 'PAGADO' %}
                                    <span class="status-btn success-btn">Pagado</span>
                                {% elif boleta.estado_pago == 'VENCIDO' %}
                                    <span class="status-btn close-btn">Vencido</span>
                                {% else %}
                                    <span class="status-btn warning-btn">Pendiente</span>
                                {% endif %}
                            </td>
                            <td>{{ boleta.fecha_emision|date:"d/m/Y" }}</td>
                            <td>
                                <a href="{% url 'empresa_boleta_detalle' boleta.id %}" class="btn btn-primary btn-sm">
                                    <i class="lni lni-eye"></i> Ver Detalle
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block page_scripts %}
<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Verificar si la tabla tiene filas antes de iniciar DataTables para evitar errores
        const tableBody = document.querySelector('#tablaBoletasCliente tbody');
        if (tableBody && tableBody.children.length > 0) {
            $('#tablaBoletasCliente').DataTable({
                "order": [[ 1, "desc" ]], 
                "language": { "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json" }
            });
        } else {
            tableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4" style="color: #e0e8f0;">No tienes boletas emitidas todavía.</td></tr>';
        }
    });
</script>
{% endblock %}